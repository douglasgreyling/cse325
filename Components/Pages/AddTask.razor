@* 
@page "/add-task"
@page "/add-task/{id}"


<h3> Add Task</h3>


@code {
    
} *@

@page "/add-task"
@page "/add-task/{Id:int}"
@rendermode InteractiveServer
@using CSE325App.Models
@inject ITodoServices TodoService
@inject NavigationManager Navigation

<PageTitle>Add Task</PageTitle>

<h3>@(Id == 0 ? "Add Task" : "Edit Task")</h3>

<div class="card p-4">
    <div class="mb-3">
        <label class="form-label">Task Name</label>
        <input class="form-control" @bind="task.TaskName" />
    </div>

    <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" @bind="task.Description"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Status</label>
        <select class="form-select" @bind="task.Status">
            <option value="Open">Open</option>
            <option value="InProgress">In Progress</option>
            <option value="Completed">Completed</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Due Date</label>
        <input type="date" class="form-control" @bind="task.DueDate" />
    </div>

    <button class="btn btn-primary me-2" @onclick="SaveTask">
        Save
    </button>

    <button class="btn btn-secondary" @onclick="Cancel">
        Cancel
    </button>
</div>

@code {

    [Parameter]
    public int Id { get; set; }

    private TodoTask task = new();

    protected override async Task OnInitializedAsync()
    {
        if (Id != 0)
        {
            var existingTask = await TodoService.GetTaskByIdAsync(Id);
            if (existingTask != null)
            {
                task = existingTask;
            }
        }
    }

    private async Task SaveTask()
    {
        if (Id == 0)
        {
            await TodoService.CreateTaskAsync(task);
        }
        else
        {
            await TodoService.UpdateTaskAsync(task);
        }

        Navigation.NavigateTo("/todo");
    }

    private void Cancel()
    {
        Navigation.NavigateTo("/todo");
    }
}
